import{r as n,j as s}from"./app-ipanO3bs.js";import{d as V,u as W,o as X,e as Y,P as C,y as b,$ as _,f as G,_ as Z,j as ee,K as te,g as u,F as re,I as se,z as ne,U as oe,h as ae,i as ie,k as le,q as ce,l as ue,m as me,n as de,p as fe,r as ge,C as pe,S as F}from"./editor-BMpVNdGD.js";import{l as be}from"./LexicalCollaborationContext.prod-cc6pWIMt.js";import{m as Ee}from"./LexicalNestedComposer.prod-BrX3N5Hz.js";import{I as he}from"./image-resizer-C2Y91f5l.js";/* empty css            */import"./index-C_p90s4v.js";import"./createLucideIcon-BjNgcmH3.js";import"./index-BTc9p8Wi.js";import"./index-1i8cz37G.js";import"./index-BPJHy-wm.js";import"./index-BqwLosHy.js";import"./dialog-u4O9cK7y.js";import"./x-BFvKxWSQ.js";import"./loading-spinner-OsfijkoL.js";import"./loader-circle-B-UiF-wi.js";import"./send-C-GDKmVg.js";import"./label-CV5JuHUW.js";import"./youtube-tgcJ6Xkw.js";import"./checkbox-DcCWn521.js";import"./textarea-Bg9_Op6O.js";import"./separator-BIStezOs.js";const $=new Set,H=V("RIGHT_CLICK_IMAGE_COMMAND");function xe(l){if(!$.has(l))throw new Promise(f=>{const o=new Image;o.src=l,o.onload=()=>{$.add(l),f(null)},o.onerror=()=>{$.add(l)}})}function Ce({altText:l,className:f,imageRef:o,src:E,width:I,height:h,maxWidth:v,onError:m}){return xe(E),s.jsx("img",{className:f||void 0,src:E,alt:l,ref:o,style:{height:h,maxWidth:v,width:I},onError:m,draggable:"false"})}function Ie(){return s.jsx("img",{src:"",style:{height:200,opacity:.2,width:200},draggable:"false"})}function Ke({src:l,altText:f,nodeKey:o,width:E,height:I,maxWidth:h,resizable:v,showCaption:m,caption:g,captionsEnabled:P}){const x=n.useRef(null),S=n.useRef(null),[i,d,R]=W(o),[p,z]=n.useState(!1),{isCollabActive:ve}=be(),[e]=X(),[j,T]=n.useState(null),M=n.useRef(null),[L,U]=n.useState(!1),q=Y(),k=n.useCallback(t=>{const r=C();return i&&b(r)&&(t.preventDefault(),e.update(()=>{r.getNodes().forEach(c=>{_(c)&&c.remove()})})),!1},[e,i]),y=n.useCallback(t=>{const r=C(),a=S.current;if(i&&b(r)&&r.getNodes().length===1){if(m)return G(null),t.preventDefault(),g.focus(),!0;if(a!==null&&a!==document.activeElement)return t.preventDefault(),a.focus(),!0}return!1},[g,i,m]),D=n.useCallback(t=>M.current===g||S.current===t.target?(G(null),e.update(()=>{d(!0);const r=e.getRootElement();r!==null&&r.focus()}),!0):!1,[g,e,d]),w=n.useCallback(t=>{const r=t;return p?!0:r.target===x.current?(r.shiftKey?d(!i):(R(),d(!0)),!0):!1},[p,i,d,R]),N=n.useCallback(t=>{e.getEditorState().read(()=>{const r=C();t.target.tagName==="IMG"&&Z(r)&&r.getNodes().length===1&&e.dispatchCommand(H,t)})},[e]);n.useEffect(()=>{let t=!0;const r=e.getRootElement(),a=ee(e.registerUpdateListener(({editorState:c})=>{t&&T(c.read(()=>C()))}),e.registerCommand(ie,(c,Q)=>(M.current=Q,!1),u),e.registerCommand(ae,w,u),e.registerCommand(H,w,u),e.registerCommand(oe,c=>c.target===x.current?(c.preventDefault(),!0):!1,u),e.registerCommand(ne,k,u),e.registerCommand(se,k,u),e.registerCommand(re,y,u),e.registerCommand(te,D,u));return r?.addEventListener("contextmenu",N),()=>{t=!1,a(),r?.removeEventListener("contextmenu",N)}},[R,e,p,i,o,k,y,D,w,N,d]);const B=()=>{e.update(()=>{const t=F(o);_(t)&&t.setShowCaption(!0)})},K=(t,r)=>{setTimeout(()=>{z(!1)},200),e.update(()=>{const a=F(o);_(a)&&a.setWidthAndHeight(t,r)})},O=()=>{z(!0)},J=i&&b(j)&&!p,A=(i||p)&&q;return s.jsx(n.Suspense,{fallback:null,children:s.jsxs(s.Fragment,{children:[s.jsx("div",{draggable:J,children:L?s.jsx(Ie,{}):s.jsx(Ce,{className:`max-w-full cursor-default ${A?`${b(j)?"draggable cursor-grab active:cursor-grabbing":""} focused ring-primary ring-2 ring-offset-2`:null}`,src:l,altText:f,imageRef:x,width:E,height:I,maxWidth:h,onError:()=>U(!0)})}),m&&s.jsx("div",{className:"image-caption-container absolute right-0 bottom-1 left-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0",children:s.jsxs(Ee,{initialEditor:g,initialNodes:[le,ce,ue],children:[s.jsx(me,{}),s.jsx(de,{}),s.jsx(fe,{contentEditable:s.jsx(pe,{className:"ImageNode__contentEditable user-select-text word-break-break-word caret-primary relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none border-0 p-2.5 text-sm whitespace-pre-wrap outline-none",placeholderClassName:"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block",placeholder:"Enter a caption..."}),ErrorBoundary:ge})]})}),v&&b(j)&&A&&s.jsx(he,{showCaption:m,setShowCaption:B,editor:e,buttonRef:S,imageRef:x,maxWidth:h,onResizeStart:O,onResizeEnd:K,captionsEnabled:!L&&P})]})})}export{H as RIGHT_CLICK_IMAGE_COMMAND,Ke as default};
