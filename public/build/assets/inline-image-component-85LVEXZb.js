import{r as a,j as e}from"./app-ipanO3bs.js";import{x as A,u as B,o as M,e as V,P as w,y as b,A as G,f as L,j as H,K as J,g as f,F as K,I as O,z as W,U as q,h as Q,i as X,m as Y,L as Z,p as ee,r as te,C as se,S as re,B as ae,D as ne,G as oe,H as ie,J as I}from"./editor-BMpVNdGD.js";import{m as le}from"./LexicalNestedComposer.prod-BrX3N5Hz.js";import{B as _}from"./createLucideIcon-BjNgcmH3.js";import{C as ce}from"./checkbox-DcCWn521.js";import{D as ue}from"./dialog-u4O9cK7y.js";import{L as k,I as de}from"./label-CV5JuHUW.js";/* empty css            */import"./index-C_p90s4v.js";import"./index-BTc9p8Wi.js";import"./index-1i8cz37G.js";import"./index-BPJHy-wm.js";import"./index-BqwLosHy.js";import"./loading-spinner-OsfijkoL.js";import"./loader-circle-B-UiF-wi.js";import"./send-C-GDKmVg.js";import"./youtube-tgcJ6Xkw.js";import"./textarea-Bg9_Op6O.js";import"./x-BFvKxWSQ.js";import"./separator-BIStezOs.js";import"./LexicalCollaborationContext.prod-cc6pWIMt.js";const P=new Set;function me(i){if(!P.has(i))throw new Promise(m=>{const l=new Image;l.src=i,l.onload=()=>{P.add(i),m(null)}})}function pe({altText:i,className:m,imageRef:l,src:g,width:c,height:d,position:u}){return me(g),e.jsx("img",{className:m||void 0,src:g,alt:i,ref:l,"data-position":u,style:{display:"block",height:d,width:c},draggable:"false"})}function fe({activeEditor:i,nodeKey:m,onClose:l}){const c=i.getEditorState().read(()=>re(m)),[d,u]=a.useState(c.getAltText()),[v,S]=a.useState(c.getShowCaption()),[C,h]=a.useState(c.getPosition()),x=()=>{const t={altText:d,position:C,showCaption:v};c&&i.update(()=>{c.update(t)}),l()};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"alt-text",children:"Alt Text"}),e.jsx(de,{id:"alt-text",placeholder:"Descriptive alternative text",onChange:t=>u(t.target.value),value:d,"data-test-id":"image-modal-alt-text-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"position-select",children:"Position"}),e.jsxs(ae,{value:C,onValueChange:t=>h(t),children:[e.jsx(ne,{id:"position-select",children:e.jsx(oe,{placeholder:"Select position"})}),e.jsxs(ie,{children:[e.jsx(I,{value:"left",children:"Left"}),e.jsx(I,{value:"right",children:"Right"}),e.jsx(I,{value:"full",children:"Full Width"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"caption",checked:v,onCheckedChange:t=>S(t)}),e.jsx(k,{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(ue,{children:e.jsx(_,{"data-test-id":"image-modal-file-upload-btn",onClick:x,children:"Confirm"})})]})}function Te({src:i,altText:m,nodeKey:l,width:g,height:c,showCaption:d,caption:u,position:v}){const[S,C]=A(),h=a.useRef(null),x=a.useRef(null),[t,j,N]=B(l),[s]=M(),[y,T]=a.useState(null),D=a.useRef(null),R=V(),E=a.useCallback(n=>{const o=w();return t&&b(o)&&(n.preventDefault(),t&&b(o)&&s.update(()=>{o.getNodes().forEach(p=>{G(p)&&p.remove()})})),!1},[s,t]),F=a.useCallback(n=>{const o=w(),r=x.current;if(t&&b(o)&&o.getNodes().length===1){if(d)return L(null),n.preventDefault(),u.focus(),!0;if(r!==null&&r!==document.activeElement)return n.preventDefault(),r.focus(),!0}return!1},[u,t,d]),$=a.useCallback(n=>D.current===u||x.current===n.target?(L(null),s.update(()=>{j(!0);const o=s.getRootElement();o!==null&&o.focus()}),!0):!1,[u,s,j]);a.useEffect(()=>{let n=!0;const o=H(s.registerUpdateListener(({editorState:r})=>{n&&T(r.read(()=>w()))}),s.registerCommand(X,(r,p)=>(D.current=p,!1),f),s.registerCommand(Q,r=>{const p=r;return p.target===h.current?(p.shiftKey?j(!t):(N(),j(!0)),!0):!1},f),s.registerCommand(q,r=>r.target===h.current?(r.preventDefault(),!0):!1,f),s.registerCommand(W,E,f),s.registerCommand(O,E,f),s.registerCommand(K,F,f),s.registerCommand(J,$,f));return()=>{n=!1,o()}},[N,s,t,l,E,F,$,j]);const U=t&&b(y),z=t&&R;return e.jsxs(a.Suspense,{fallback:null,children:[e.jsxs(e.Fragment,{children:[e.jsxs("span",{draggable:U,children:[R&&e.jsx(_,{className:"image-edit-button absolute top-1 right-1",variant:"outline",ref:x,onClick:()=>{C("Update Inline Image",n=>e.jsx(fe,{activeEditor:s,nodeKey:l,onClose:n}))},children:"Edit"}),e.jsx(pe,{className:`max-w-full cursor-default ${z?`${b(y)?"draggable cursor-grab active:cursor-grabbing":""} focused ring-primary ring-2 ring-offset-2`:null}`,src:i,altText:m,imageRef:h,width:g,height:c,position:v})]}),d&&e.jsx("div",{className:"image-caption-container absolute right-0 bottom-1 left-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0",children:e.jsxs(le,{initialEditor:u,children:[e.jsx(Y,{}),e.jsx(Z,{}),e.jsx(ee,{contentEditable:e.jsx(se,{placeholder:"Enter a caption...",className:"ImageNode__contentEditable user-select-text word-break-break-word caret-primary relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none border-0 p-2.5 text-sm whitespace-pre-wrap outline-none",placeholderClassName:"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block"}),ErrorBoundary:te})]})})]}),S]})}export{fe as UpdateInlineImageDialog,Te as default};
