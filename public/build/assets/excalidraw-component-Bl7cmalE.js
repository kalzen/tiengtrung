import{r as n,j as u}from"./app-D0tGY9dM.js";import{o as T,e as y,u as B,S as b,j as H,I as _,g as w,z as F,h as J,Y as L,Z as k}from"./editor-BYv2-Q3p.js";import{r as W}from"./percentages-BXMCSKIN-C1834s23.js";import{I as Y}from"./image-resizer-BrAbjRRk.js";/* empty css            */import"./index-BtVzuSVv.js";import"./createLucideIcon-ChOAi-eC.js";import"./index-Dc-jfdN_.js";import"./index-705hPj7j.js";import"./index-B-N1yRK0.js";import"./index-BStAVYXS.js";import"./dialog-DwHTjvPy.js";import"./x-CN7NPRRI.js";import"./loading-spinner-BrDIyboT.js";import"./loader-circle-B5b2RBVN.js";import"./send-B5DjOSro.js";import"./label-B4KF-rkq.js";import"./youtube-D7rVIVvm.js";import"./checkbox-DdKPwfYG.js";import"./textarea-DoTJowVI.js";import"./separator-Df4wLjte.js";import"./index-CzJ9628H.js";const Z=e=>{const r=e?.firstElementChild?.firstElementChild,c=e.getAttribute("viewBox");if(c!=null){const m=c.split(" ");e.setAttribute("width",m[2]),e.setAttribute("height",m[3])}r&&r.tagName==="style"&&r.remove()};function q({elements:e,files:r,imageContainerRef:c,appState:m,rootClassName:s=null,width:l="inherit",height:d="inherit"}){const[f,S]=n.useState(null);n.useEffect(()=>{(async()=>{const i=await W({appState:m,elements:e,files:r});Z(i),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("display","block"),S(i)})()},[e,r,m]);const p={};return l!=="inherit"&&(p.width=`${l}px`),d!=="inherit"&&(p.height=`${d}px`),u.jsx("div",{ref:g=>{g&&c&&(c.current=g)},className:s??"",style:p,dangerouslySetInnerHTML:{__html:f?.outerHTML??""}})}function gt({nodeKey:e,data:r,width:c,height:m}){const[s]=T(),l=y(),[d,f]=n.useState(r==="[]"&&s.isEditable()),S=n.useRef(null),p=n.useRef(null),g=n.useRef(null),[i,R,x]=B(e),[C,j]=n.useState(!1),E=n.useCallback(t=>(i&&(t.preventDefault(),s.update(()=>{const o=b(e);o&&o.remove()})),!1),[s,i,e]);n.useEffect(()=>{if(!l){i&&x();return}return H(s.registerCommand(J,t=>{const o=p.current,a=t.target;return C?!0:o!==null&&o.contains(a)?(t.shiftKey||x(),R(!i),t.detail>1&&f(!0),!0):!1},w),s.registerCommand(F,E,w),s.registerCommand(_,E,w))},[x,s,i,C,E,R,l]);const A=n.useCallback(()=>(f(!1),s.update(()=>{const t=b(e);t&&t.remove()})),[s,e]),D=(t,o,a)=>s.update(()=>{const v=b(e);k(v)&&(t&&t.length>0||Object.keys(a).length>0?v.setData(JSON.stringify({appState:o,elements:t,files:a})):v.remove())}),I=()=>{j(!0)},z=(t,o)=>{setTimeout(()=>{j(!1)},200),s.update(()=>{const a=b(e);k(a)&&(a.setWidth(t),a.setHeight(o))})},O=n.useCallback(()=>{f(!0)},[]),{elements:h=[],files:M={},appState:N={}}=n.useMemo(()=>JSON.parse(r),[r]),$=n.useCallback(()=>{f(!1),h.length===0&&s.update(()=>{const t=b(e);t&&t.remove()})},[s,e,h.length]);return u.jsxs(u.Fragment,{children:[l&&d&&u.jsx(L,{initialElements:h,initialFiles:M,initialAppState:N,isShown:d,onDelete:A,onClose:$,onSave:(t,o,a)=>{D(t,o,a),f(!1)},closeOnClickOutside:!1}),h.length>0&&u.jsxs("button",{ref:p,className:`m-0 border-0 bg-transparent p-0 ${i?"user-select-none ring-primary ring-2 ring-offset-2":""}`,children:[u.jsx(q,{imageContainerRef:S,className:"image",elements:h,files:M,appState:N,width:c,height:m}),i&&l&&u.jsx("div",{className:"image-edit-button",role:"button",tabIndex:0,onMouseDown:t=>t.preventDefault(),onClick:O}),(i||C)&&l&&u.jsx(Y,{buttonRef:g,showCaption:!0,setShowCaption:()=>null,imageRef:S,editor:s,onResizeStart:I,onResizeEnd:z,captionsEnabled:!0})]})]})}export{gt as default};
