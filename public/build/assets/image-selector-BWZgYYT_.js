import{r as n,j as e}from"./app-D0tGY9dM.js";import{c as y,B as o,a as h}from"./createLucideIcon-ChOAi-eC.js";import{L as Y,I as v}from"./label-B4KF-rkq.js";import{a as pe,c as ge,d as fe,e as je,g as Ne}from"./dialog-DwHTjvPy.js";import{L as we,a as Z,U as ve,P as ye,D as be,T as W,I as ke}from"./loading-spinner-BrDIyboT.js";import{c as ee}from"./index-BtVzuSVv.js";import{X as se}from"./x-CN7NPRRI.js";import{H as Se}from"./house-BHZe69RU.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Fe=y("File",Ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],B=y("Folder",ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Te=y("Grid3x3",Ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Me=y("Search",De);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Q=y("SquarePen",Re);function ae({folders:x,currentPath:c,onNavigate:f,onToggleExpansion:p,level:u=0}){return e.jsx("div",{className:"space-y-1",children:x.map(t=>e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{t.children&&t.children.length>0?p(t.path):f(t.path)},className:h("w-full flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors text-left",c===t.path?"bg-primary text-primary-foreground":"hover:bg-muted",u>0&&"ml-4"),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[t.children&&t.children.length>0&&e.jsx(ee,{className:h("h-3 w-3 transition-transform",t.isExpanded&&"rotate-90")}),u===0?e.jsx(Se,{className:"h-4 w-4 flex-shrink-0"}):e.jsx(B,{className:"h-4 w-4 flex-shrink-0"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate",children:t.name}),e.jsxs("div",{className:"text-xs opacity-70",children:[t.itemCount," items"]})]})]}),t.isExpanded&&t.children&&t.children.length>0&&e.jsx(ae,{folders:t.children,currentPath:c,onNavigate:f,onToggleExpansion:p,level:u+1})]},t.path))})}function Le({open:x,onOpenChange:c,onSelectFile:f,fileType:p="all",multiple:u=!1,size:t="default"}){const[b,E]=n.useState([]),[k,T]=n.useState([]),[S,d]=n.useState([]),[D,_]=n.useState([]),[j,te]=n.useState("upload/userfiles"),[re,$]=n.useState(!1),[M,O]=n.useState(!1),[R,ne]=n.useState(""),[m,le]=n.useState("grid"),[N,ie]=n.useState(new Set),[oe,L]=n.useState(!1),[I,U]=n.useState(""),[C,F]=n.useState(null),[P,z]=n.useState(""),g=n.useCallback(async s=>{$(!0);try{const a=window?.route,r=a?a("file-manager.index"):"/file-manager",l=new URLSearchParams;s&&l.append("path",s);const i=await fetch(`${r}?${l.toString()}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(i.ok){const w=await i.json();E(w.files),T(w.folders),_(w.breadcrumbs),te(w.currentPath)}}catch(a){console.error("Error fetching files:",a)}finally{$(!1)}},[]),A=n.useCallback(async()=>{try{const s=window?.route,a=s?s("file-manager.index"):"/file-manager",r=await fetch(`${a}?tree=true`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(r.ok){const l=await r.json();d(l.folders||[])}}catch(s){console.error("Error fetching all folders:",s)}},[]),ce=async s=>{const a=s.target.files;if(!(!a||a.length===0)){O(!0);try{const r=window?.route,l=r?r("file-manager.upload"):"/file-manager/upload";for(let i=0;i<a.length;i++){const w=a[i],q=new FormData;q.append("file",w),q.append("path",j),(await fetch(l,{method:"POST",body:q,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok&&await g(j)}}catch(r){console.error("Upload error:",r)}finally{O(!1),s.target.value=""}}},K=async(s,a)=>{if(confirm(`Bạn có chắc muốn xóa ${a==="folder"?"thư mục":"file"} này?`))try{const l=window?.route,i=l?l("file-manager.delete"):"/file-manager/delete";(await fetch(i,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({path:s,type:a})})).ok&&await g(j)}catch(l){console.error("Delete error:",l)}},H=async()=>{if(I.trim())try{const s=window?.route,a=s?s("file-manager.create-folder"):"/file-manager/folder";(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({name:I,path:j})})).ok&&(U(""),L(!1),await g(j))}catch(s){console.error("Create folder error:",s)}},X=async()=>{if(!(!C||!P.trim()))try{const s=window?.route,a=s?s("file-manager.rename"):"/file-manager/rename";(await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({oldPath:C.path,newName:P})})).ok&&(F(null),z(""),await g(j))}catch(s){console.error("Rename error:",s)}},V=s=>{g(s)},de=s=>{d(a=>{const r=l=>l.map(i=>i.path===s?{...i,isExpanded:!i.isExpanded}:i.children?{...i,children:r(i.children)}:i);return r(a)})},me=s=>{g(s)},he=s=>{if(u){const a=new Set(N);a.has(s.name)?a.delete(s.name):a.add(s.name),ie(a)}else f?.(s),c(!1)},xe=()=>{b.filter(a=>N.has(a.name)).forEach(a=>f?.(a)),c(!1)},ue=s=>{if(s===0)return"0 Bytes";const a=1024,r=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,l)).toFixed(2))+" "+r[l]},G=b.filter(s=>{const a=s.name.toLowerCase().includes(R.toLowerCase()),r=p==="all"||p==="image"&&s.isImage;return a&&r}),J=k.filter(s=>s.name.toLowerCase().includes(R.toLowerCase()));return n.useEffect(()=>{x&&(g(),A())},[x,g,A]),e.jsx(pe,{open:x,onOpenChange:c,children:e.jsxs(ge,{className:"fixed z-50 bg-background overflow-hidden flex flex-col md:flex-row",style:{width:"80vw",height:"90vh",maxWidth:"none",maxHeight:"none",top:"5vh",left:"10vw",transform:"none",borderRadius:"8px",padding:0},showCloseButton:!1,children:[e.jsx(fe,{className:"sr-only",children:"File Manager"}),e.jsx(je,{className:"sr-only",children:"Browse and manage files and folders. Upload, create, rename, and delete files and folders."}),e.jsxs("div",{className:"w-full md:w-80 border-b md:border-b-0 md:border-r bg-muted/30 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Folders"]})}),e.jsx("div",{className:"flex-1 p-2 overflow-auto",children:e.jsx("nav",{className:"space-y-1",children:S.length>0?e.jsx(ae,{folders:S,currentPath:j,onNavigate:V,onToggleExpansion:de}):e.jsx("div",{className:"text-sm text-muted-foreground px-3 py-2",children:"No folders found"})})})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx(Ne,{className:"border-b p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:D.map((s,a)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>me(s.path),className:"text-sm hover:text-primary transition-colors",children:s.name}),a<D.length-1&&e.jsx(ee,{className:"h-4 w-4 mx-1 text-muted-foreground"})]},s.path))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>le(m==="grid"?"list":"grid"),children:m==="grid"?e.jsx(we,{className:"h-4 w-4"}):e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>c(!1),children:e.jsx(se,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"border-b p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 flex flex-wrap gap-2",children:[e.jsx(Y,{htmlFor:"file-upload",className:"sr-only",children:"Upload Files"}),e.jsx(v,{id:"file-upload",type:"file",multiple:!0,onChange:ce,accept:p==="image"?"image/*":void 0,disabled:M,className:"hidden"}),e.jsx(o,{onClick:()=>document.getElementById("file-upload")?.click(),disabled:M,size:"sm",children:M?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2",size:14}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Upload"]})}),e.jsxs(o,{variant:"outline",onClick:()=>L(!0),size:"sm",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Create"]}),e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Download"]})]}),u&&N.size>0&&e.jsxs(o,{onClick:xe,size:"sm",children:["Select ",N.size," File",N.size>1?"s":""]})]})}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search files and folders...",value:R,onChange:s=>ne(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:re?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(Z,{})}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:h("grid gap-2 sm:gap-4",m==="grid"?"grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8":"grid-cols-1"),children:[J.map(s=>e.jsxs("div",{className:h("group relative border rounded-lg p-3 cursor-pointer transition-all hover:border-primary",m==="list"&&"flex items-center gap-3"),onClick:()=>V(s.path),children:[e.jsx("div",{className:h("flex items-center justify-center bg-blue-50 rounded",m==="grid"?"h-16 sm:h-24 mb-2":"h-12 w-12 flex-shrink-0"),children:e.jsx(B,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-500"})}),e.jsx("div",{className:h("flex-1 min-w-0",m==="list"&&"flex items-center gap-4"),children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",title:s.name,children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.itemCount," items"]}),m==="list"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at*1e3).toLocaleDateString()})]})}),e.jsxs("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 sm:h-8 sm:w-8",onClick:a=>{a.stopPropagation(),F({path:s.path,name:s.name,type:"folder"}),z(s.name)},children:e.jsx(Q,{className:"h-3 w-3"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 sm:h-8 sm:w-8",onClick:a=>{a.stopPropagation(),K(s.path,"folder")},children:e.jsx(W,{className:"h-3 w-3"})})]})]},s.path)),G.map(s=>e.jsxs("div",{className:h("group relative border rounded-lg p-3 cursor-pointer transition-all hover:border-primary",N.has(s.name)&&"border-primary bg-primary/5",m==="list"&&"flex items-center gap-3"),onClick:()=>he(s),children:[e.jsx("div",{className:h("flex items-center justify-center bg-muted rounded",m==="grid"?"h-16 sm:h-24 mb-2":"h-12 w-12 flex-shrink-0"),children:s.isImage?e.jsx("img",{src:s.url,alt:s.name,className:"max-w-full max-h-full object-cover rounded"}):e.jsx(Fe,{className:"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground"})}),e.jsx("div",{className:h("flex-1 min-w-0",m==="list"&&"flex items-center gap-4"),children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",title:s.name,children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ue(s.size)}),m==="list"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.uploaded_at*1e3).toLocaleDateString()})]})}),e.jsxs("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 sm:h-8 sm:w-8",onClick:a=>{a.stopPropagation(),F({path:s.path,name:s.name,type:"file"}),z(s.name)},children:e.jsx(Q,{className:"h-3 w-3"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 sm:h-8 sm:w-8",onClick:a=>{a.stopPropagation(),K(s.path,"file")},children:e.jsx(W,{className:"h-3 w-3"})})]}),u&&N.has(s.name)&&e.jsx("div",{className:"absolute top-1 left-1 sm:top-2 sm:left-2 bg-primary text-primary-foreground rounded-full w-4 h-4 sm:w-5 sm:h-5 flex items-center justify-center",children:e.jsx("span",{className:"text-xs",children:"✓"})})]},s.path))]}),J.length===0&&G.length===0&&e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:"No files or folders found"})]})})]}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-background p-6 rounded-lg w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create New Folder"}),e.jsx(v,{placeholder:"Folder name",value:I,onChange:s=>U(s.target.value),className:"mb-4",onKeyDown:s=>{s.key==="Enter"&&H()}}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>L(!1),children:"Cancel"}),e.jsx(o,{onClick:H,children:"Create"})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-background p-6 rounded-lg w-full max-w-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Rename ",C.type]}),e.jsx(v,{placeholder:"New name",value:P,onChange:s=>z(s.target.value),className:"mb-4",onKeyDown:s=>{s.key==="Enter"&&X()}}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>F(null),children:"Cancel"}),e.jsx(o,{onClick:X,children:"Rename"})]})]})})]})})}function Ke({value:x,onChange:c,label:f="Featured Image",placeholder:p="Select an image...",className:u,size:t="default"}){const b=d=>typeof document<"u"?`${(document.querySelector('meta[name="asset-base"]')?.content||"/").replace(/\/$/,"")}/${d.replace(/^\//,"")}`:`/${d.replace(/^\//,"")}`,[E,k]=n.useState(!1),T=d=>{c?.(d.url)},S=()=>{c?.("")};return e.jsxs("div",{className:h("space-y-2",u),children:[e.jsx(Y,{children:f}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-start gap-4",children:[x&&e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:h("relative border rounded-lg overflow-hidden bg-muted flex-shrink-0",t==="large"?"w-48 h-48":"w-32 h-32"),children:[e.jsx("img",{src:x,alt:"Featured image",className:"w-full h-full object-cover",onError:d=>{d.currentTarget.src=b("placeholder.jpg")}}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"}),e.jsx(o,{variant:"destructive",size:"sm",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:S,children:e.jsx(se,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(v,{value:x||"",onChange:d=>c?.(d.target.value),placeholder:p,className:"flex-1"}),e.jsxs(o,{type:"button",variant:"outline",size:t==="large"?"lg":"sm",onClick:()=>k(!0),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Browse Files"]})]})]})}),e.jsx(Le,{open:E,onOpenChange:k,onSelectFile:T,fileType:"image",size:t})]})}export{Ke as I};
