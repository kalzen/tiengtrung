import{r as p,j as t}from"./app-ipanO3bs.js";import{l as S}from"./LexicalCollaborationContext.prod-cc6pWIMt.js";import{o as C,u as O,P as k,y as w,N,j as $,I as E,g as v,z as I,h as z,S as P,O as R}from"./editor-BMpVNdGD.js";import{B as D}from"./createLucideIcon-BjNgcmH3.js";import{I as V}from"./label-CV5JuHUW.js";/* empty css            */import"./index-C_p90s4v.js";import"./index-BTc9p8Wi.js";import"./index-1i8cz37G.js";import"./index-BPJHy-wm.js";import"./index-BqwLosHy.js";import"./dialog-u4O9cK7y.js";import"./x-BFvKxWSQ.js";import"./loading-spinner-OsfijkoL.js";import"./loader-circle-B-UiF-wi.js";import"./send-C-GDKmVg.js";import"./youtube-tgcJ6Xkw.js";import"./checkbox-DcCWn521.js";import"./textarea-Bg9_Op6O.js";import"./separator-BIStezOs.js";function A(s){return s.reduce((n,c)=>n+c.votes.length,0)}function B({option:s,index:n,options:c,totalVotes:o,withPollNode:m}){const{clientID:l}=S(),x=p.useRef(null),u=s.votes,h=u.indexOf(l)!==-1,i=u.length,b=s.text;return t.jsxs("div",{className:"mb-2.5 flex flex-row items-center",children:[t.jsx("div",{className:`relative mr-2.5 flex h-[22px] w-[22px] rounded-md border border-gray-400 ${h?'border-primary bg-primary after:pointer-events-none after:absolute after:top-1 after:left-2 after:m-0 after:block after:h-[9px] after:w-[5px] after:rotate-45 after:cursor-pointer after:border-r-2 after:border-b-2 after:border-solid after:border-white after:content-[""]':""}`,children:t.jsx("input",{ref:x,className:"absolute block h-full w-full cursor-pointer border-0 opacity-0",type:"checkbox",onChange:d=>{m(a=>{a.toggleVote(s,l)})},checked:h})}),t.jsxs("div",{className:"border-primary relative flex flex-[10px] cursor-pointer overflow-hidden rounded-md border",children:[t.jsx("div",{className:"transition-width bg-accent absolute top-0 left-0 z-0 h-full duration-1000 ease-in-out",style:{width:`${i===0?0:i/o*100}%`}}),t.jsx("span",{className:"text-primary absolute top-1.5 right-4 text-xs",children:i>0&&(i===1?"1 vote":`${i} votes`)}),t.jsx(V,{type:"text",value:b,onChange:d=>{const a=d.target,g=a.value,e=a.selectionStart,r=a.selectionEnd;m(f=>{f.setOptionText(s,g)},()=>{a.selectionStart=e,a.selectionEnd=r})},placeholder:`Option ${n+1}`})]}),t.jsx("button",{disabled:c.length<3,className:"relative z-0 ml-1.5 flex h-7 w-7 cursor-pointer rounded-md border-0 bg-transparent bg-[position:6px_6px] bg-no-repeat opacity-30 before:absolute before:top-1.5 before:left-[13px] before:block before:h-[15px] before:w-0.5 before:-rotate-45 before:bg-gray-400 before:content-[''] after:absolute after:top-1.5 after:left-[13px] after:block after:h-[15px] after:w-0.5 after:rotate-45 after:bg-gray-400 after:content-[''] hover:bg-gray-100 hover:opacity-100 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:opacity-30","aria-label":"Remove",onClick:()=>{m(d=>{d.deleteOption(s)})}})]})}function se({question:s,options:n,nodeKey:c}){const[o]=C(),m=p.useMemo(()=>A(n),[n]),[l,x,u]=O(c),[y,h]=p.useState(null),i=p.useRef(null),b=p.useCallback(e=>{const r=k();return l&&w(r)&&(e.preventDefault(),o.update(()=>{r.getNodes().forEach(j=>{N(j)&&j.remove()})})),!1},[o,l]);p.useEffect(()=>$(o.registerUpdateListener(({editorState:e})=>{h(e.read(()=>k()))}),o.registerCommand(z,e=>{const r=e;return r.target===i.current?(r.shiftKey||u(),x(!l),!0):!1},v),o.registerCommand(I,b,v),o.registerCommand(E,b,v)),[u,o,l,c,b,x]);const d=(e,r)=>{o.update(()=>{const f=P(c);N(f)&&e(f)},{onUpdate:r})},a=()=>{d(e=>{e.addOption(R())})},g=w(y)&&l;return t.jsx("div",{className:`bg-background max-w-[600px] min-w-[400px] cursor-pointer rounded-lg border border-gray-200 select-none ${g?"outline-primary outline outline-2":""}`,ref:i,children:t.jsxs("div",{className:"m-4 cursor-default",children:[t.jsx("h2",{className:"m-0 mb-4 text-center text-lg text-gray-600",children:s}),n.map((e,r)=>{const f=e.uid;return t.jsx(B,{withPollNode:d,option:e,index:r,options:n,totalVotes:m},f)}),t.jsx("div",{className:"flex justify-center",children:t.jsx(D,{onClick:a,size:"sm",children:"Add Option"})})]})})}export{se as default};
